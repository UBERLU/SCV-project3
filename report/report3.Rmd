---
title: "Project 3"
author: "Daryna Bilodid & Thomas Blomet"
date: "12/12/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r , echo=FALSE, warning=FALSE, message = FALSE}
library(plotly)
library(tidyverse)
library(ggplot2)
library(pals)
library(RColorBrewer)
pacman::p_load(tidyverse, pacman, ggmap, janitor, sf, mapview, leaflet, rgdal, RColorBrewer,lubridate, boot, broom)
```

```{r , echo=FALSE, warning=FALSE, message = FALSE}
load("data_ready.RData")
```

# Introduction and description of database

The aim of this report is to analyze how the naturalization in Switzerland evolved in the last years and to understand the profile of the people that seek to obtain the Swiss nationality.
Since, there is many attributes that we should take into account, we thoroughly analyze the characteristics of such people, as well as the way they obtained the Swiss nationality. 

The following analysis is performed using the data that is provided by the Swiss Federal Statistical Office (FSO later in the report), which is the national competence center for official statistics in Switzerland.
The analysis is performed on the data generated between 2011 and 2020. 

We are particularly interested in this interval of time because in June 2014, the Swiss Parliament updated the Federal Act on Swiss Citizenship (RS 141.0) and passed a law that restricts heavily the process of naturalization and adds new conditions to it.
The law entered in force in January 2018.
One of the motivation of this report is to verify and quantify the effect of this law on the number of naturalization. 

For this report, we are using 2 complementary dataset: the population of Switzerland by cantons and the geographical characteristics of the cantons.
The data is provided by FSO.
The main dataset that is used for the report is composed of the following variables:

- `Previous.citizenship`: categorical variable stating the previous citizenship of the individual;

- `Age`: the numeric variable stating the age of the individual (between 0 and 100 years);

- `Genre`: categorical variable representing the gender of the individual (Male or Female);

- `Type.of.acquisition`: categorical variable stating the type of acquisition with the following 5 levels:

  - `Confirmation of the Swiss nationality`: individual claims to be a Swiss citizen and has to prove it to the authorities;
  
  - `Naturalisation by adoption`: individual is adopted by a Swiss citizen;
  
  - `Ordinary naturalisation`: standard way to acquire Swiss citizenship;
  
  - `Reintegration`: individual had Swiss citizenship but lost it in the past;
  
  - `Simplified naturalisation`: for special cases, e.g., wife or husband of a Swiss citizen, child of a Swiss citizen, etc.
  
- `Canton`: categorical variable with 26 factor levels stating the canton where the Swiss citizenship is acquired;

- `Year`: time variable which represents the year of acquisition of Swiss citizenship (from 2011 to 2020); and,

- `Value`: the total number of Swiss nationality acquisitions depending on all the previous criterias.

#------------------------------------------------------------------------------

The population of Switzerland is now of 8,670 millions in 2020 which was of 7,955 millions in 2011.
The number is growing and the number of foreigner citizen is too, from which some of them get the Swiss citizenship.
In this document we will explore a database about the acquisition of Swiss nationality.

# General overview of data

```{r echo=FALSE, out.width='80%'}
knitr::include_graphics('plots/daryna/nat_map.png')
```

```{r echo=FALSE, out.width='80%'}
knitr::include_graphics('plots/daryna/nat_map.gif')
```

```{r , echo=FALSE, warning=FALSE, message = FALSE, out.width='60%'}
total_by_year <- data_ready %>%
  group_by(year) %>%
  summarise(total = sum(total))
```


```{r, echo=FALSE, warning=FALSE, message = FALSE}
total_by_year <- total_by_year %>%
  rename(Year = year,
         Total = total)
```


```{r, echo=FALSE, warning=FALSE, message = FALSE}
data_ready <- data_ready %>%
  rename(Year = year,
         Total = total,
         Canton = canton,
         Relative = relative)
```


```{r , echo=FALSE, warning=FALSE, message = FALSE, out.width='50%', out.height='50%'}
p <- ggplot(total_by_year, aes(x = Year, y = Total)) + geom_line() +
  geom_point() +
  scale_x_continuous(breaks=seq(2011, 2020, 1)) +
  ylim(0,50000) +
  theme_bw() +
  labs(title = "Total number of naturalisations over time",
       x = "Year",
       y = "") +
  theme(plot.title = element_text(hjust = 0.5, size = 10))

ggplotly(p)
```

```{r , echo=FALSE, warning=FALSE, message = FALSE, out.width='50%', out.height='50%'}
p <- ggplot(data_ready, aes(x = Year, y = Total)) +
  geom_point() +
  geom_smooth() +
  scale_x_continuous(breaks=seq(2011, 2020, 1)) +
  ylim(0,11000) + 
  theme_bw() + 
  labs(title = "Total number of naturalisations over time",
       x = "Year",
       y = "") +
  theme(plot.title = element_text(hjust = 0.5, size = 10))
ggplotly(p)
```

```{r , echo=FALSE, warning=FALSE, message = FALSE, out.width='50%', out.height='50%'}
p <- ggplot(data_ready, aes(x=as.factor(Year), y=Total)) +
  geom_boxplot() + 
  labs(title = "Total number of naturalisations over time",
       x = "Year",
       y = "") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, size = 10)) 
ggplotly(p)
```

```{r echo=FALSE, out.width='80%'}
knitr::include_graphics('plots/daryna/relat_map.png')
```

```{r echo=FALSE, out.width='80%'}
knitr::include_graphics('plots/daryna/relative_map.gif')
```

```{r, echo=FALSE, out.width='70%', out.height='70%'}
p <- ggplot(data_ready, aes(x = Year, y = Total, fill = Canton)) +
  geom_area(color = "black") +
  labs(title = "Total number of naturalisations by canton over time",
       subtitle = "2011 - 2020",
       x = "Year",
       y = "",
       fill = "Canton") +
  scale_x_continuous(breaks=seq(2011, 2020, 1)) +
  theme_minimal() +
  theme(axis.text.x=element_text(angle=45, hjust=1)) +
  theme(plot.title = element_text(hjust = 0.5))
ggplotly(p)
```


```{r, echo=FALSE, out.width='70%', out.height='70%'}
p <- ggplot(data_ready, aes(x = Year, y = Relative, fill = Canton)) +
  geom_area(color = "black") +
  labs(title = "Relative number of naturalisations by Canton over time",
       subtitle = "2011 - 2020",
       x = "Year",
       y = "",
       fill = "Canton") +
  scale_x_continuous(breaks=seq(2011, 2020, 1)) +
  theme_minimal() +
  theme(axis.text.x=element_text(angle=45, hjust=1)) +
  theme(plot.title = element_text(hjust = 0.5))
ggplotly(p)
```

# Investigating the type of acquisition

```{r echo=FALSE, out.width='60%'}
knitr::include_graphics('plots/thomas/chart_acquisition.png')
```

Looking at this chart, we see that there is two main type of acquisition (ordinary one and simplified one) for a total of 99.38%.
As defined in the introduction, there is three type of acquisition that are really special cases (`Confirmation of the Swiss nationality`, `Naturalisation by adoption` and `Reintegration`).

```{r echo=FALSE, out.width='70%'}
knitr::include_graphics('plots/daryna/total_age_gender_nat.png')
```

```{r echo=FALSE, out.width='60%'}
knitr::include_graphics('plots/daryna/nat_age_gender.gif')
```

We will focus on these three in the next part and then we won't consider it anymore in order to focus on the two main types of acquisition.

## Basic exploration of three less represented types of acquisiton

Let's take a look at the following type of acquisition : `Confirmation of the Swiss nationality`, `Naturalization by adoption` and `Reintegration`. Since each type of acquisition are quite different, we will take a look at them one by one.

### `Confirmation of the Swiss nationality`

First, note that there has been only `1452` confirmation between 2011 and 2020 which lead to a mean of `145.2` per year. We first plot the total number of such citizens for the 50 citizenship with the higher values and then look at all by age and gender.

```{r echo=FALSE, out.width='50%'}
knitr::include_graphics('plots/thomas/confirmation_previous_citizenship.png')
```

We can see that in the top 10, except for Brazil, there is only European countries, in particular the three first are bordering ones. This may be due to the fact that most of expatriation of Swiss citizen is in European countries, particularly in western Europe (Germany, France, Italy, Spain).

```{r echo=FALSE, out.width='50%'}
knitr::include_graphics('plots/thomas/confirmation_age_gender.png')
```

Most of confirmation concerns persons aged less than 20, 90.22% of the total count of confirmed Swiss citizenship. This may be due to the fact that child from Swiss citizens are not immediately declared on their birth day.

### `Naturalization by adoption`

To acquire Swiss citizenship through adoption if the person adopted was under the age of majority (18 years) at the time of adoption.

As before, note that there has been `776` naturalization by adoption between 2011 and 2020 which lead to a mean of `77.6` per year. We first plot the total number of such citizens for the 50 citizenship with the higher values and then look at all by age and gender.

```{r echo=FALSE, out.width='50%'}
knitr::include_graphics('plots/thomas/adoption_previous_citizenship.png')
```

We can see that for previous citizenship with higher numbers are not European, except for Russia and Germany. Ones with higher numbers are countries where poverty is far more present that in Switzerland, especially when we see that Ethiopia is almost 1/5 of the total.
Ethiopia is the first because during several years a lot of Ethiopian child were adopted over the world, this number was multiplied by 10 around 2010.
However, there has been some problems with Ethiopian adoption due to the fact that a lot of child were kidnapped.
We will come back to this when exploring adoption over time.

```{r echo=FALSE, out.width='50%'}
knitr::include_graphics('plots/thomas/adoption_age_gender.png')
```

We see that most of naturalization by adoption are acquired before 20 years, which is relevant with what has been written at the beginning of this section since the concerned person has to be adopted before having attained majority. Note that only 7 persons were 20 or more, so 0.9% of total adopted naturalization concerns. This is due to the fact that to acquire Swiss citizenship by adoption, the procedure is simplified until 18 years.

### `Reintegration`

This type of acquisition is the less represented, there has been only 162 reinstatement of Swiss citizenship in 10 years. This concerns people that have previously held Swiss citizenship but lost it by forfeiting or relieving citizenship, or by marrying a foreign person. There is different criteria for reintegration based on where the concerned person lives. Some criteria are purely subjective ones.

Note that there has been only `162` naturalization by adoption between 2011 and 2020 which lead to a mean of `16.2` per year. We first plot the total number of such citizens and then look at all by age and gender.

```{r echo=FALSE, out.width='50%'}
knitr::include_graphics('plots/thomas/reintegration_previous_citizenship.png')
```

We can see that the top 4 is composed only by bordering countries which means that concerned individuals may have gone to these countries after losing their Swiss citizenship. We also see that `Stateless` appeared on y axis which means that the individual that obtained the Swiss citizenship had only Swiss nationality when he lost it.

```{r echo=FALSE, out.width='50%'}
knitr::include_graphics('plots/thomas/reintegration_age_gender.png')
```

The most represented class of age is people aged between 30 and 39 with a count of 55, which represents 33.95% of the total amount of reintegrated people.

### Over time

We will now visualize time series of these three type of acquisitions. Beginning with `Confirmation of the Swiss nationality`, we see that the number of such acquisition is decreasing since 2012 and has been divided by almost 4 in 9 years. **COMMENT ON THIS : trouve rien, très peu d'informations à ce sujet** For `Naturalization by adoption`, there has been a huge drop between 2013 and 2015.
This is due to the fact that there has been new regulations concerning adoption of Ethiopian child form the Ethiopian government in 2014 (see **source directive du 4 juillet 2016 (adoption)**).
Finishing with `Reintegration`, numbers are slowly increasing throughout the years except for a peak in 2019 where the number seems extreme compared to other years. **COMMENT ON THIS : trouve rien...**

```{r echo=FALSE, out.width='50%'}
knitr::include_graphics('plots/thomas/over_time_rein_adop_conf.png')
```

# Exploration by ordinary and simplified naturalization categorized

In this section we will explore ordinary and simplified naturalization and compare them since these two type of acquisition are the most common ones. We can also compare these two since the procedure is quite the same.

In the following plot we visualize the count of ordinary and simplified naturalization by previous citizenship for the 50 most represented one.
European countries are most presented.
Note that the top 6 of these countries represent more than half over all naturalization between 2011 and 2020.
We see that there is 3 of these 6 that are bordering ones (Germany, France and Italy).
Numbers are proportional to the number of foreigners from each countries.

```{r echo=FALSE, out.width='50%'}
knitr::include_graphics('plots/thomas/ordin_simpl_previous_citizenship_percentage.png')
```

In the next plot we can compare count for ordinary and simplified naturalization by previous citizenship ordered as before.
It seems that there is more ordinary naturalization for almost all previous citizenship.
This is due to the fact that simplified naturalization is more restrictive.
It will be clearer in the next plot.

```{r echo=FALSE, out.width='50%'}
knitr::include_graphics('plots/thomas/ordin_simpl_previous_citizenship.png')
```

There is really few previous citizenship for which there has been more simplified than ordinary naturalization (Brazil, Thailand, Ukraine, etc).
An example to this fact could be that the population which acquire Swiss citizenship is the third generation form these countries to be in Switzerland and thus have access to simplified instead of ordinary naturalization.

```{r echo=FALSE, out.width='50%'}
knitr::include_graphics('plots/thomas/ordin_simpl_proportion_previous_citizenship.png')
```

Now taking a look over age class, we see that for simplified naturalization middle age (30-49) is the most represented, by 70.51% against 32.6% for ordinary naturalization.
This could be due to the fact that simplified is accessible to husband or wife of Swiss citizen and thus is more frequent for middle class age.
On the contrary, for ordinary naturalization, it is more homogeneous over all class, which reflects the fact that it is the more general acquisition and thus, doesn't concern a really particular portion of the population that wishes to acquire Swiss citizenship. 

```{r echo=FALSE, out.width='50%'}
knitr::include_graphics('plots/thomas/ordin_simpl_age_gender.png')
```

**Je les mets toutes pour le moment**

```{r echo=FALSE, out.width='60%'}
knitr::include_graphics('plots/daryna/plot_map_ord.png')
```

```{r echo=FALSE, out.width='60%'}
knitr::include_graphics('plots/daryna/relat_ord.png')
```

```{r echo=FALSE, out.width='60%'}
knitr::include_graphics('plots/daryna/simpfied_map.png')
```

```{r echo=FALSE, out.width='60%'}
knitr::include_graphics('plots/daryna/relat_simplified.png')
```

```{r echo=FALSE, out.width='50%'}
knitr::include_graphics('plots/thomas/over_time_ordin_simpl.png')
```